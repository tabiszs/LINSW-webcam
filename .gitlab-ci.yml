#
# Notes: $CI_COMMIT_REF_NAME => master or branch-xyz
#

stages:
#  - build
  - test
  - deploy
#  - cleanup

before_script:
  - python -V
  - pip install tox
  - export TZ=Europe/Amsterdam
  - date

cache:
  paths:
    - .cache/

mypy:
  image: python:3
  stage: test
  script:
    - tox -e mypy


flake8:
  image: python:3
  stage: test
  script:
    - tox -e flake8

deploy_pypi:
  image: python:3
  stage: deploy
  environment: deploy
  script:
    - pip install -U twine
    - rm -rf dist
    - python setup.py check bdist_wheel
    - twine upload dist/* --verbose --skip-existing
  only:
    - master

#
#cleanup_pypirc:
#  image: python:3
#  stage: cleanup
##   when: always   # this is important; run even if preceding stages failed.
#  script:
#    - rm -vf ~/.pypirc  # we don't want to leave these around, but GitLab may clean up anyway.